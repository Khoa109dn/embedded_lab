#include "servo.h"

void Servo_Init(void) {
    RCC->APB1ENR |= RCC_APB1ENR_TIM2EN;
    RCC->APB2ENR |= RCC_APB2ENR_IOPAEN;

    GPIOA->CRL |= GPIO_CRL_MODE0 | GPIO_CRL_CNF0_1;

    TIM2->PSC = 71;
    TIM2->ARR = 19999;
    TIM2->CCMR1 |= TIM_CCMR1_OC1M_1 | TIM_CCMR1_OC1M_2;
    TIM2->CCER |= TIM_CCER_CC1E;
    TIM2->CR1 |= TIM_CR1_CEN;
}

void Servo_SetAngle(uint8_t angle) {
    TIM2->CCR1 = 500 + (angle * 11);
}
