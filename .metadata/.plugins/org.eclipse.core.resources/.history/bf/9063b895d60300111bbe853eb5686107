#include "stm32f103xb.h"
#include "can.h"

void UART1_Init(void) {
    RCC->APB2ENR |= RCC_APB2ENR_USART1EN | RCC_APB2ENR_IOPAEN;
    GPIOA->CRH &= ~(0xFF << 4);
    GPIOA->CRH |= (0xB << 4) | (0x4 << 8); // PA9: TX, PA10: RX
    USART1->BRR = 72000000 / 9600; // 9600 baud
    USART1->CR1 |= USART_CR1_TE | USART_CR1_RE | USART_CR1_UE;
}

int main(void) {
    SystemClock_Config(); // Dùng hàm cũ của bạn
    UART1_Init();
    CAN_Init();

    while (1) {
        if (USART1->SR & USART_SR_RXNE) {
            uint8_t data = (uint8_t)USART1->DR;
            // Giả sử bạn gửi byte thô (ví dụ mã ASCII hoặc số)
            CAN_SendAngle(data);
        }
    }
}
